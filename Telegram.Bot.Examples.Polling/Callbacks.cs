using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;
using System.Threading.Tasks;
using Telegram.Bot.Examples.Polling.Files;
using Telegram.Bot.Examples.Polling.Helpers;
using Telegram.Bot.Examples.Polling.MethodsDB;
using Telegram.Bot.Types;
using Telegram.Bot.Examples.Polling.Games;

namespace Telegram.Bot.Examples.Polling
{
    public static class Callbacks
    {
        public static async Task FlipCoin(ITelegramBotClient _botClient, CallbackQuery callbackQuery, CancellationToken cancellationToken)
        {
            await _botClient.DeleteMessageAsync(
                            chatId: callbackQuery.Message.Chat.Id,
                            messageId: callbackQuery.Message.MessageId);
            long whoseCoin = Convert.ToInt64(data[2].Trim());

            if (whoseCoin != callbackQuery.From.Id)
            {
                await _botClient.SendTextMessageAsync(
                    chatId: callbackQuery.Message.Chat.Id,
                    text: $"\"{callbackQuery.From.FirstName}\", –Ω–µ —Å—Ç–æ–∏—Ç –≤–º–µ—à–∏–≤–∞—Ç—å—Å—è –Ω–µ –≤ —Å–≤–æ–µ –¥–µ–ª–æ.",
                    cancellationToken: cancellationToken);
                await Task.Delay(2000);
                await _botClient.SendTextMessageAsync(
                chatId: callbackQuery.Message.Chat.Id,
                    text: "–°—ç—Ä, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –¥–≤–∏–≥–∞–π—Ç–µ—Å—å.",
                    cancellationToken: cancellationToken);
                TelegramAPI.SendGif(callbackQuery.Message.Chat.Id, GIFs.PleaseDontMove);
                await Task.Delay(2000);

                InteractWithPlayer.DeletePlayer(callbackQuery.From.Id);

                //TODO –≠—Ç—É —Ö—É–π–Ω—é –Ω–∞–¥–æ —É–±—Ä–∞—Ç—å, —Ç.–∫. –≤ —Å–ª—É—á–∞–µ —Å–º–µ—Ä—Ç–∏ –∏–≥—Ä–æ–∫–∞ –¥–æ–ª–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å—Å—è —Å–æ–±—ã—Ç–∏–µ —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º
                await _botClient.SendTextMessageAsync(
                    chatId: callbackQuery.Message.Chat.Id,
                    text: $"–ò–≥—Ä–æ–∫ {callbackQuery.From.FirstName} —É–±–∏—Ç.üíÄ",
                    cancellationToken: cancellationToken);
                return;
            }

            TelegramAPI.SendGif(callbackQuery.Message.Chat.Id, GIFs.CoinFlip);
            await Task.Delay(3000);
            int coinSide = Convert.ToInt32(value);
            if (Games.CoinFlip(coinSide))
            {
                await _botClient.SendTextMessageAsync(
                chatId: callbackQuery.Message.Chat.Id,
                    text: "–ñ–µ–ª–∞—é —Ö–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è.üôå",
                    cancellationToken: cancellationToken);
                TelegramAPI.SendGif(callbackQuery.Message.Chat.Id, GIFs.PlayerWin);
            }
            else
            {
                await _botClient.SendTextMessageAsync(
                    chatId: callbackQuery.Message.Chat.Id,
                text: "–ú–Ω–µ –∂–∞–ª—å...üî™",
                    cancellationToken: cancellationToken);
                await Task.Delay(1000);
                TelegramAPI.SendGif(callbackQuery.Message.Chat.Id, GIFs.PlayerLose);
                InteractWithPlayer.DeletePlayer(callbackQuery.From.Id);

                //TODO –≠—Ç—É —Ö—É–π–Ω—é –Ω–∞–¥–æ —É–±—Ä–∞—Ç—å, —Ç.–∫. –≤ —Å–ª—É—á–∞–µ —Å–º–µ—Ä—Ç–∏ –∏–≥—Ä–æ–∫–∞ –¥–æ–ª–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å—Å—è —Å–æ–±—ã—Ç–∏–µ
                await _botClient.SendTextMessageAsync(
                    chatId: callbackQuery.Message.Chat.Id,
                    text: $"–ò–≥—Ä–æ–∫ {callbackQuery.From.FirstName} —É–±–∏—Ç.üíÄ",
                    cancellationToken: cancellationToken);
            }
        }
    }
}
